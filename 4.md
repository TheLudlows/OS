#### 4.1 文件控制块

目录本身就是一种有结构文件，由一条条记录组成，每条记录对应一个在改目录下的文件，目录文件中的一条记录就是一个文件控制块(FCB)。一个FCB就是一个文件目录项。 FCB 中包含了文件的基本信息(文件名、物理地址、逻辑结构、物 理结构等)，存取控制信息(是否可读/可写、禁止访问的用户名单等)，使用信息(如文件的建立时间、修改时间等)。 最重要最基本的还是文件名、文件存放的物理地址。

搜索:当用户要使用一个文件时，系统要根据文件名搜索目录，找到该文件对应的目录项
创建文件:创建一个新文件时，需要在其所属的目录中增加一个目录项
删除文件:当删除一个文件时，需要在目录中删除相应的目录项
显示目录:用户可以请求显示目录的内容，如显示该目录中的所有文件及相应属性
修改目录:某些文件属性保存在目录中，因此这些属性变化时需要修改相应的目录项(如:文
件重命名)

树形目录结构
用户(或用户进程)要访问某个文件时要用文件路径名标识文件，文件路径名是个字符串。各级目录之间 用“/”隔开。从根目录出发的路径称为绝对路径。
无环图目录结构
在树形目录结构的基础上，增加一些指向同一节点的有向边，使整个目录成为一个有向无环图。可以更方便地实现多个用户间的文件共享。

其实在查找各级目录的过程中只需要用到“文件名”这个信息，只有文件名匹配时，才需要读出文件的其他信息。因此可以考虑让目录表“瘦身”来提升效率。引入索引节点
除了文件名之外的所有信息都放在索引节点中，每个文件对应一个索引节点，目录项中只包含文件名索引节点指针。

#### 4.2 文件分配方式
类似于内存分页，磁盘中的存储单元也会被分为一个个“块/磁盘块/物理 块”。很多操作系统中，磁盘块的大小与内存块、页面的大小相同。内存与磁盘之间的数据交换(即 读/写操作、磁盘I/O)都是以块为单位进行的。即每次读入一块，或每次写出一块

操作系统为文件分配存储空间都是以块为单位的，用户通过逻辑地址来操作自己的文件，操作系统要负责实现从逻辑地址到物理地址的映射。

**连续分配**
连续分配方式要求每个文件在磁盘上占有一组连续的块。

读取某个磁盘块时，需要移动磁头。访问的两个磁盘块相隔越远，移动磁头所需时间就越长。连续分配的文件在顺序读/写时速度最快

若此时文件要拓展，需要再增加一个磁盘块。 由于采用连续结构，因此 文件占用的磁盘块必须是 连续的。 因此只能将文件全部迁移到绿色区域。物理上采用连续分配的文件不方便拓展。

物理上采用连续分配，存储空间利用率低，会产生难以利用的磁盘碎片可以用紧凑来处理碎片，但是需要耗费很大的时间代价。

**链接分配**
链接分配采取离散分配的方式，可以为文件分配离散的磁盘块。分为隐式链接和显式链接两种。

隐式链接——除文件的最后一个盘块之外，每个盘块中都存有指向下一个盘块的指针。文件目录 包括文件第一块的指针和最后一块的指针。 
优点:很方便文件拓展，不会有碎片问题，外存利用率高。
缺点:只支持顺序访问，不支持随机访问，查找效率低，指向下一个盘块的指针也需要耗费少量 的存储空间。

显式链接——把用于链接文件各物理块的指针显式地存放在一张表中，即 文件分配表(FAT，File Allocation Table)。一个磁盘只会建立一张文件分配表。开机时文件分配表放入内存，并常驻内 存。 
优点:很方便文件拓展，不会有碎片问题，外存利用率高，并且支持随机访问。相比于隐式链接 来说，地址转换时不需要访问磁盘，因此文件的访问效率更高。
缺点:文件分配表的需要占用一定的存储空间。

**索引分配**

索引分配允许文件离散地分配在各个磁盘块中，系统会为每个文件建立一张索引表，索引表中记录了文 件的各个逻辑块对应的物理块(索引表的功能类似于内存管理中的页表——建立逻辑页面到物理页之间 的映射关系)。索引表存放的磁盘块称为索引块。文件数据存放的磁盘块称为数据块。