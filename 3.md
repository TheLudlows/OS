#### 3.1 内存概述

内存用来放数据，程序执行前需要先放到内存中才能被CPU处理——缓和CPU与硬盘之间的速度矛盾。内存地址从0 开始，每个 地址对应一 个存储单元。

操作系统作为系统资源的管理者，当然也需要对内存 进行管理

1. 操作系统负责内存空间的分配与回收，分为连续分配和非连续分配
2. 提供某种技术从逻辑上对内存空间进行扩充
3. 供地址转换功能，负责程序的逻辑地址与物理地 址的转换
4. 提供内存保护功能。保证各进程在各自存储空间内 运行，互不干扰

#### 3.2 地址转换

为了使编程更方便，程序员写程序时应该只需要关注指令、数据的逻辑地址。而逻辑地址到物理地址的转换（重定位）应该由操作系统负责，这样就保证了程序员写程序时不需要关注 物理内存的实际情况。

三种装入方式

- 绝对装入，编译时产生绝对地址
- 可重入装入，装入时将逻辑地址转换为物理地址
- 动态运行时装入，运行时将逻辑地址转换为物理地址，需设置重定位寄存器，也是现代操作系统使用的方式

#### 3.3内存保护

内存保护可采取两种方法一是在CPU中设置一对上、下限寄存器，存放 进程的上、下限地址。进程的指令要访问某个地址 时，CPU检查是否越界。二是采用重定位寄存器（又称基址寄存器）和界 地址寄存器（又称限长寄存器）进行越界检查。重定 位寄存器中存放的是进程的起始物理地址。界地址寄 存器中存放的是进程的最大逻辑地址。

#### 3.4 覆盖和交换

覆盖技术的思想：将程序分为多个段（多个模块）。 常用的段常驻内存，不常用的段在需要时调入内存。 内存中分为一个固定区和若干个“覆盖区。 需要常驻内存的段放在固定区中，调入后就不再 调出（除非运行结束） 不常用的段放在覆盖区，需要用到时调入内存， 用不到时调出内存。必须由程序员声明覆盖结构，操作系统完成自动覆盖。缺点：对用户不透明，增加了用户编程负担。 覆盖技术只用于早期的操作系统中，现在已成为历史。

交换（对换）技术的设计思想：内存空间紧张时，系统将内存中某些进程暂时换出外存，把外存中 某些已具备运行条件的进程换入内存，进程在内存与磁盘间动态调度。暂时换出外存等待的进程状态为挂起状态（挂起态，suspend） 挂起态又可以进一步细分为就绪挂起、阻塞挂起两种状态。

中级调度（内存调度），就是要决定将哪个处于挂起状态的进程重新调入内存。

1. 具有对换功能的操作系统中，通常把磁盘空间分为文件区和对换区两部分。文件 区主要用于存放文件，主要追求存储空间的利用率，因此对文件区空间的管理采 用离散分配方式；对换区空间只占磁盘空间的小部分，被换出的进程数据就存放 在对换区。由于对换的速度直接影响到系统的整体速度，因此对换区空间的管理 主要追求换入换出速度，因此通常对换区采用连续分配方式（。总之，对换区的I/O速度比文件区的更快。
2.   交换通常在许多进程运行且内存吃紧时进行，而系统负荷降低就暂停。例如：在 发现许多进程运行时经常发生缺页，就说明内存紧张，此时可以换出一些进程； 如果缺页率明显下降，就可以暂停换出。
3.  可优先换出阻塞进程；可换出优先级低的进程；为了防止优先级低的进程在被调 入内存后很快又被换出，有的系统还会考虑进程在内存的驻留时间

另外PCB 会常驻内存，不会被换出外存。



#### 3.5 连续分配

连续分配指为用户进程分配的必须是一个连续的内存空间，分为单一连续分配、固定分区分配和动态分区分配。

内部碎片，分配给某进程的内存区域中，如果有些部分没有用上。 外部碎片，是指内存中的某些空闲分区由于太小而难以利用。

在单一连续分配方式中，内存被分为系统区和用户区。 系统区通常位于内存的低地址部分，用于存放操作系统 相关数据；用户区用于存放用户进程相关数据。 内存中只能有一道用户程序，用户程序独占整个用户区 空间。存在于早期的 PC 操作 系统 MS-DOS。

为了能在内 存中装入多道程序，且这些程序之间又不会相互干扰， 于是将整个用户空间划分为若干个固定大小的分区，在 每个分区中只装入一道作业，这样就形成了最早的、最 简单的一种可运行多道程序的内存管理方式。固定分配分为两类

- 分区大小相等：缺乏灵活性，但是很适合用于用一台计 算机控制多个相同对象的场合
- 分区大小不等：增加了灵活性，可以满足不同大小的进 程需求。根据常在系统中运行的作业大小情况进行划分。操作系统需要建立一个数据结构——分区说明表，来实现各个分区的分配与回 收。每个表项对应一个分区，通常按分区大小排列。每个表项包括对应分区的 大小、起始地址、状态。该方式会产生内部碎片，内存利用率低。

动态分区分配又称为可变分区分配。这种分配方式不会预先划分内存分区，而是在进程装入内存时， 根据进程的大小动态地建立分区，并使分区的大小正好适合进程的需要。因此系统分区的大小和数 目是可变的。

系统要用需记录内存的使用情况，有两种方式

- 空闲分区表：每 个空闲分区对应 一个表项。表项 中包含分区号、 分区大小、分区 起始地址等信息
- 空闲分区链：每个分区的起始部分和末尾部分分别设置前向指 针和后向指针。起始部分处还可记录分区大小等信息

动态分区分配回收内存时相邻的空闲分区要合并。

动态分区分配没有内部碎片，但是有外部碎片。可以通过紧凑（拼凑，Compaction）技术来解决外部碎片。

|      |      |      |      |      |
| ---- | ---- | ---- | ---- | ---- |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |

